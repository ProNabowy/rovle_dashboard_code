import{r as d,n as A,g as I,j as a,F as R,z as f,I as x,A as E,i as V,G as q,D,a1 as W,y as O}from"./index-rFxOd0i4.js";const B=(e,h,r)=>{const i=d.useRef(),l=d.useRef(),c=d.useRef(),[n,w]=d.useState(0),j=A(h,"id",r),[u,t]=d.useState({weight:"",price:"",id:"",provider_id:r});return{inputWeightRef:i,inputQuntiyRef:c,setAddNewPackage:t,inputPriceRef:l,handelAddNewPackage:()=>{var g,s,N,m,F;!i.current.value||!l.current.value?I.warning("Advertencia","Por favor, completa los campos requeridos."):((s=(g=e==null?void 0:e.values)==null?void 0:g.presentations)==null?void 0:s.some(o=>parseInt(o.weight)===parseInt(u.weight)&&parseInt(o.price)===parseInt(u.price)))?I.warning("Advertencia","Por favor, no agregues un paquete duplicado"):j!=null&&j.manage_stock&&!((N=c.current)!=null&&N.value)?I.warning("Advertencia","Por favor, completa el campo de cantidad."):(u.id=n,e.setFieldValue("presentations",[...(m=e==null?void 0:e.values)==null?void 0:m.presentations,{...u,provider_id:r}]),w(o=>o+1),i.current.value="",l.current.value="",(F=c.current)!=null&&F.value&&(c.current.value=""),I.success("Bien","Paquete añadido con éxito."))},removePackage:g=>{var s,N;return(N=(s=e==null?void 0:e.values)==null?void 0:s.presentations)==null?void 0:N.filter(m=>+m.id!=+g)},roasters:h}};function G({formik:e,removePackage:h}){var r,i;return a.jsx("div",{className:"col-span-12 md:col-span-6",children:a.jsx("div",{className:"border border-[#252525] p-2 sm:p-[32px] rounded-md sm:rounded-[20px] h-full max-h-[270px] overflow-y-auto add-package",children:(i=(r=e==null?void 0:e.values)==null?void 0:r.presentations)==null?void 0:i.map((l,c)=>a.jsxs("div",{id:l.id,className:"flex items-center justify-between p-3 rounded-[5px] border border-[#252525] mb-3 sm:mb-5",children:[a.jsxs("p",{className:"font-medium text-[#252525] text-[14px] sm:text-base",children:[l.price," Euro por ",l.weight," gr"]}),a.jsx(R,{icon:f,onClick:n=>e.setFieldValue("presentations",h(l.id)),className:"text-[#252525] text-[20px] cursor-pointer"})]},c))})})}function K({formik:e,roasters:h,provider_id:r}){var u;const{inputWeightRef:i,inputQuntiyRef:l,setAddNewPackage:c,inputPriceRef:n,handelAddNewPackage:w,removePackage:j}=B(e,h,r);return a.jsxs("div",{className:"rounded-md sm:rounded-[20px] mt-5 sm:mt-20 border border-[#252525] p-3 sm:p-[32px] grid grid-cols-12 gap-3 md:gap-10",children:[a.jsxs("form",{onSubmit:t=>t.preventDefault(),autoComplete:"off",className:"col-span-12 md:col-span-6",children:[a.jsxs("div",{className:"mb-5 sm:mb-8",children:[a.jsx("label",{htmlFor:"Weight /gm",className:"label",children:"Peso"}),a.jsx(x,{type:"number",ref:i,placeholder:"Ingresar Peso /gr",onChange:t=>c(p=>({...p,weight:t.target.value})),id:"Weight /gm"})]}),a.jsxs("div",{className:"mb-5 sm:mb-8",children:[a.jsx("label",{htmlFor:"PriceEuro",className:"label",children:"Precio"}),a.jsx(x,{type:"number",ref:n,placeholder:"Ingresar Precio /Euro",onChange:t=>c(p=>({...p,price:t.target.value})),id:"PriceEuro"})]}),(u=A(h,"id",r))!=null&&u.manage_stock?a.jsxs("div",{className:"mb-8",children:[a.jsx("label",{htmlFor:"Units",className:"label",children:"Cantidad"}),a.jsx(x,{type:"number",ref:l,placeholder:"Cantidad",onChange:t=>c(p=>({...p,units:t.target.value})),id:"Units"})]}):null,a.jsx("button",{type:"button",onClick:w,className:"bg-[#58291E] sm:text-[20px] text-center text-white font-medium w-full py-2 sm:py-[16px] px-4 sm:px-[24px] rounded-md sm:rounded-full",children:"Añadir Paquete"})]}),a.jsx(G,{formik:e,removePackage:j})]})}const L=(e,h,r)=>{const i=new q,[l,c]=d.useState([]),[n,w]=d.useState({}),[j,u]=d.useState([]),[t,p]=d.useState({}),{setIsLoading:y,user:g}=d.useContext(E),s=g==null?void 0:g.provider,[N,m]=d.useState([]);d.useEffect(()=>{y(!0),i.getRoasters().then(o=>c(o)).finally(o=>y(!1))},[]),d.useEffect(()=>{var o;if((o=e.values)!=null&&o.provider_id){const b=l==null?void 0:l.filter(C=>{var v;return C.id==((v=e.values)==null?void 0:v.provider_id)});p(b==null?void 0:b[0])}s&&!(n!=null&&n.provider_id)?(u(s),p(s),m(s==null?void 0:s.coffee_shops),e.setFieldValue("provider_id",s==null?void 0:s.id)):u(l)},[l]);const P=V().search.slice(-4)==="true";return d.useEffect(()=>{m(t==null?void 0:t.coffee_shops),e.setFieldValue("provider_id",t==null?void 0:t.id)},[t]),d.useEffect(()=>(e.setFieldValue("origins",h),()=>{}),[h]),d.useEffect(()=>(e.setFieldValue("presentations",r),()=>{}),[r]),d.useEffect(()=>((n==null?void 0:n.provider_id)&&i.getRoasters().then(b=>{var C;if(c(b),s){const v=(C=b==null?void 0:b.filter(_=>(_==null?void 0:_.id)===(s==null?void 0:s.id)))==null?void 0:C[0];u(v),p(v),m(v==null?void 0:v.coffee_shops)}}),()=>{}),[n]),{isByNewOWner:P,coffee:N,selectedProvider:t,setSelectedProvider:p,rosters:j,isProvider:s,setAddedShops:w,allRoasters:l,addedShops:n}};function U({formik:e,originsList:h,packagesList:r}){var y,g,s,N,m,F,P,o,b,C,v;const{coffee:i,isByNewOWner:l,isProvider:c,selectedProvider:n,setSelectedProvider:w,rosters:j,allRoasters:u,setAddedShops:t,addedShops:p}=L(e,h,r);return a.jsxs("form",{onSubmit:e.handleSubmit,autoComplete:"off",className:"px-2 sm:px-10 add-product",children:[a.jsxs("div",{className:"flex-container",children:[l?a.jsxs("div",{className:`${c?"w-full":"w-full sm:w-[48%]"}`,children:[a.jsx("label",{htmlFor:"factor",className:"label",children:"Nombre del proveedor"}),a.jsx(x,{required:!0,value:(y=e==null?void 0:e.values)==null?void 0:y.owner_name,name:"owner_name",type:"text",onChange:e.handleChange,id:"factor",placeholder:"Ingresa el nombre del propietario."})]}):null,c?null:a.jsxs("div",{className:`w-full sm:w-[48%] ${l?"":"flex-1"}`,children:[a.jsx("label",{htmlFor:"owner",className:"label",children:"Roaster To"}),a.jsx(D,{value:n,onChange:_=>{var S;return w(A(j,"id",(S=_.target.value)==null?void 0:S.id))},options:j,optionLabel:"commercial_name",inputId:"owner",emptyFilterMessage:"No hay opciones disponibles",emptyMessage:"No hay opciones disponibles",filter:!0,placeholder:"Seleccionar Tostador",className:"w-full p-2  !shadow-none !rounded-none border-[#b3b3b3] !border-t-transparent !border-l-transparent !border-r-transparent"})]})]}),a.jsxs("div",{className:"flex-container",children:[a.jsxs("div",{className:"w-full sm:w-[48%]",children:[a.jsx("label",{htmlFor:"commercial_name",className:"label",children:"Nombre del Producto"}),a.jsx(x,{value:(g=e==null?void 0:e.values)==null?void 0:g.commercial_name,name:"commercial_name",type:"text",required:!0,onChange:e.handleChange,id:"commercial_name",placeholder:"Este será el nombre que aparecerá en el listado en el shop."})]}),a.jsxs("div",{className:"w-full sm:w-[48%]",children:[a.jsx("label",{htmlFor:"code",className:"label",children:"Código"}),a.jsx(x,{onChange:e.handleChange,value:(s=e==null?void 0:e.values)==null?void 0:s.code,name:"code",type:"text",id:"code",placeholder:"Ingresar Código"})]})]}),a.jsx(W,{classNames:"!w-full mb-8",formik:e,provider_id:(N=e.values)==null?void 0:N.provider_id}),a.jsxs("div",{className:"mb-8",children:[a.jsx("label",{htmlFor:"Region",className:"label",children:"Región"}),a.jsx(x,{value:(m=e==null?void 0:e.values)==null?void 0:m.region,name:"region",type:"text",onChange:e.handleChange,id:"Region",placeholder:"Ingresar Región"})]}),a.jsxs("div",{className:"flex-container",children:[a.jsxs("div",{className:"w-full sm:w-[48%]",children:[a.jsx("label",{htmlFor:"farm",className:"label",children:"Finca"}),a.jsx(x,{value:(F=e==null?void 0:e.values)==null?void 0:F.farm,name:"farm",type:"text",onChange:e.handleChange,id:"farm",placeholder:"Ingresar Finca"})]}),a.jsxs("div",{className:"w-full sm:w-[48%]",children:[a.jsx("label",{htmlFor:"sca_score",className:"label",children:"Puntuación Sca s"}),a.jsx(x,{value:(P=e==null?void 0:e.values)==null?void 0:P.sca_score,name:"sca_score",type:"number",min:80,max:100,required:!0,step:"0.01",onChange:e.handleChange,id:"sca_score",placeholder:"Ingresar Puntuación Sca s"})]})]}),a.jsxs("div",{className:"flex-container",children:[a.jsxs("div",{className:"w-full sm:w-[48%]",children:[a.jsx("label",{htmlFor:"altitude",className:"label",children:"Altitud"}),a.jsx(x,{value:(o=e==null?void 0:e.values)==null?void 0:o.altitude,name:"altitude",type:"number",min:0,max:8e3,required:!0,onChange:e.handleChange,id:"altitude",placeholder:"Ingresar Altitud"})]}),a.jsxs("div",{className:"w-full sm:w-[48%]",children:[a.jsx("label",{htmlFor:"process",className:"label",children:"Proceso"}),a.jsx(x,{value:(b=e==null?void 0:e.values)==null?void 0:b.process,name:"process",type:"text",onChange:e.handleChange,id:"process",placeholder:"Ingresar Proceso"})]})]}),a.jsxs("div",{className:"mb-8",children:[a.jsx("label",{htmlFor:"Variedad",className:"label",children:"Variedad"}),a.jsx(x,{value:(C=e==null?void 0:e.values)==null?void 0:C.grades,name:"grades",type:"text",onChange:e.handleChange,id:"Variedad",placeholder:"Ingresar Variedad"})]}),a.jsx(O,{formik:e,dataKey:"coffeeShops",url:"/setups/coffee-shop/add-coffee",title:"Tiendas",pageKey:"Coffee Shops",pagePermissionKeyName:"dashboard.coffeeShops.store",options:i,stateList:t,listOfState:p}),a.jsxs(d.Fragment,{children:[a.jsx("label",{htmlFor:"Description",className:"label",children:"Descripción"}),a.jsx("textarea",{rows:5,onChange:e.handleChange,type:"text",value:(v=e==null?void 0:e.values)==null?void 0:v.description,name:"description",id:"Description",className:"p-3 w-full border rounded-[5px] mt-5 resize-none border-[#b3b3b3] placeholder:text-[#b3b3b3]",placeholder:"Ingresar Descripción"})]}),a.jsx(K,{formik:e,roasters:u,provider_id:n==null?void 0:n.id}),a.jsx("button",{type:"submit",className:"min-btn mt-5 sm:mt-10 block ml-auto",children:"Enviar"})]})}export{U as P};
