import{r as c,p as S,h as I,j as a,F as A,z as E,I as x,A as D,n as q,G as V,D as W,Y as O,y as f}from"./index-UqVmnRqZ.js";const T=(e,p,r)=>{const u=c.useRef(),l=c.useRef(),d=c.useRef(),[t,w]=c.useState(0),m=S(p,"id",r),[o,n]=c.useState({weight:"",price:"",id:"",provider_id:r});return{inputWeightRef:u,inputQuntiyRef:d,setAddNewPackage:n,inputPriceRef:l,handelAddNewPackage:()=>{var g,s,N,b,F;!u.current.value||!l.current.value?I.warning("warning","Please Fill The Reqriure Inputs"):((s=(g=e==null?void 0:e.values)==null?void 0:g.presentations)==null?void 0:s.some(i=>parseInt(i.weight)===parseInt(o.weight)&&parseInt(i.price)===parseInt(o.price)))?I.warning("warning","Please Don't Add Duplicate Package"):m!=null&&m.manage_stock&&!((N=d.current)!=null&&N.value)?I.warning("warning","Please fill out Quantity Field"):(o.id=t,e.setFieldValue("presentations",[...(b=e==null?void 0:e.values)==null?void 0:b.presentations,{...o,provider_id:r}]),w(i=>i+1),u.current.value="",l.current.value="",(F=d.current)!=null&&F.value&&(d.current.value=""),I.success("success","Package Add Successfully"))},removePackage:g=>{var s,N;return(N=(s=e==null?void 0:e.values)==null?void 0:s.presentations)==null?void 0:N.filter(b=>+b.id!=+g)},roasters:p}};function G({formik:e,removePackage:p}){var r,u;return a.jsx("div",{className:"col-span-6",children:a.jsx("div",{className:"border border-[#252525] p-[32px] rounded-[20px] h-full max-h-[270px] overflow-y-auto add-package",children:(u=(r=e==null?void 0:e.values)==null?void 0:r.presentations)==null?void 0:u.map((l,d)=>a.jsxs("div",{id:l.id,className:"flex items-center justify-between p-3 rounded-[5px] border border-[#252525] mb-5",children:[a.jsxs("p",{className:"font-medium text-[#252525]",children:[l.price," Euro por ",l.weight," gm"]}),a.jsx(A,{icon:E,onClick:t=>e.setFieldValue("presentations",p(l.id)),className:"text-[#252525] text-[20px] cursor-pointer"})]},d))})})}function K({formik:e,roasters:p,provider_id:r}){var o;const{inputWeightRef:u,inputQuntiyRef:l,setAddNewPackage:d,inputPriceRef:t,handelAddNewPackage:w,removePackage:m}=T(e,p,r);return a.jsxs("div",{className:"rounded-[20px] mt-20 border border-[#252525] p-[32px] grid grid-cols-12 gap-10",children:[a.jsxs("form",{onSubmit:n=>n.preventDefault(),className:"col-span-6",children:[a.jsxs("div",{className:"mb-8",children:[a.jsx("label",{htmlFor:"Weight /gm",className:"label",children:"Peso"}),a.jsx(x,{type:"number",ref:u,placeholder:"Ingresar Peso /gr",onChange:n=>d(h=>({...h,weight:n.target.value})),id:"Weight /gm"})]}),a.jsxs("div",{className:"mb-8",children:[a.jsx("label",{htmlFor:"PriceEuro",className:"label",children:"Precio"}),a.jsx(x,{type:"number",ref:t,placeholder:"Ingresar Precio /Euro",onChange:n=>d(h=>({...h,price:n.target.value})),id:"PriceEuro"})]}),(o=S(p,"id",r))!=null&&o.manage_stock?a.jsxs("div",{className:"mb-8",children:[a.jsx("label",{htmlFor:"Units",className:"label",children:"Cantidad"}),a.jsx(x,{type:"number",ref:l,placeholder:"Cantidad",onChange:n=>d(h=>({...h,units:n.target.value})),id:"Units"})]}):null,a.jsx("button",{type:"button",onClick:w,className:"bg-[#58291E] text-[20px] text-center text-white font-medium w-full py-[16px] px-[24px] rounded-full",children:"Añadir Paquete"})]}),a.jsx(G,{formik:e,removePackage:m})]})}const L=(e,p,r)=>{const u=new V,[l,d]=c.useState([]),[t,w]=c.useState({}),[m,o]=c.useState([]),[n,h]=c.useState({}),{setIsLoading:y,user:g}=c.useContext(D),s=g==null?void 0:g.provider,[N,b]=c.useState([]);c.useEffect(()=>{y(!0),u.getRoasters().then(i=>d(i)).finally(i=>y(!1))},[]),c.useEffect(()=>{var i;if((i=e.values)!=null&&i.provider_id){const v=l==null?void 0:l.filter(C=>{var j;return C.id==((j=e.values)==null?void 0:j.provider_id)});h(v==null?void 0:v[0])}s&&!(t!=null&&t.provider_id)?(o(s),h(s),b(s==null?void 0:s.coffee_shops),e.setFieldValue("provider_id",s==null?void 0:s.id)):o(l)},[l]);const P=q().search.slice(-4)==="true";return c.useEffect(()=>{b(n==null?void 0:n.coffee_shops),e.setFieldValue("provider_id",n==null?void 0:n.id)},[n]),c.useEffect(()=>(e.setFieldValue("origins",p),()=>{}),[p]),c.useEffect(()=>(e.setFieldValue("presentations",r),()=>{}),[r]),c.useEffect(()=>((t==null?void 0:t.provider_id)&&u.getRoasters().then(v=>{var C;if(d(v),s){const j=(C=v==null?void 0:v.filter(_=>(_==null?void 0:_.id)===(s==null?void 0:s.id)))==null?void 0:C[0];o(j),h(j),b(j==null?void 0:j.coffee_shops)}}),()=>{}),[t]),{isByNewOWner:P,coffee:N,selectedProvider:n,setSelectedProvider:h,rosters:m,isProvider:s,setAddedShops:w,allRoasters:l,addedShops:t}};function U({formik:e,originsList:p,packagesList:r}){var y,g,s,N,b,F,P,i,v,C,j;const{coffee:u,isByNewOWner:l,isProvider:d,selectedProvider:t,setSelectedProvider:w,rosters:m,allRoasters:o,setAddedShops:n,addedShops:h}=L(e,p,r);return a.jsxs("form",{onSubmit:e.handleSubmit,className:"px-10 add-product",children:[a.jsxs("div",{className:"flex-container",children:[l?a.jsxs("div",{className:`${d?"w-full":"w-[48%]"}`,children:[a.jsx("label",{htmlFor:"factor",className:"label",children:"Nombre del proveedor"}),a.jsx(x,{required:!0,value:(y=e==null?void 0:e.values)==null?void 0:y.owner_name,name:"owner_name",type:"text",onChange:e.handleChange,id:"factor",placeholder:"Enter factor name"})]}):null,d?null:a.jsxs("div",{className:`w-[48%] ${l?"":"flex-1"}`,children:[a.jsx("label",{htmlFor:"owner",className:"label",children:"Roaster To"}),a.jsx(W,{value:t,onChange:_=>{var R;return w(S(m,"id",(R=_.target.value)==null?void 0:R.id))},options:m,optionLabel:"commercial_name",inputId:"owner",filter:!0,placeholder:"Seleccionar Tostador",className:"w-full p-2  !shadow-none !rounded-none border-[#b3b3b3] !border-t-transparent !border-l-transparent !border-r-transparent"})]})]}),a.jsxs("div",{className:"flex-container",children:[a.jsxs("div",{className:"sm:w-[48%]",children:[a.jsx("label",{htmlFor:"commercial_name",className:"label",children:"Nombre del Producto"}),a.jsx(x,{value:(g=e==null?void 0:e.values)==null?void 0:g.commercial_name,name:"commercial_name",type:"text",required:!0,onChange:e.handleChange,id:"commercial_name",placeholder:"Este será el nombre que aparecerá en el listado en el shop."})]}),a.jsxs("div",{className:"sm:w-[48%]",children:[a.jsx("label",{htmlFor:"code",className:"label",children:"Código"}),a.jsx(x,{value:(s=e==null?void 0:e.values)==null?void 0:s.code,name:"code",type:"text",required:!0,onChange:e.handleChange,id:"code",placeholder:"Ingresar Código"})]})]}),a.jsx(O,{classNames:"!w-full mb-8",formik:e,provider_id:(N=e.values)==null?void 0:N.provider_id}),a.jsxs("div",{className:"mb-8",children:[a.jsx("label",{htmlFor:"Region",className:"label",children:"Region"}),a.jsx(x,{value:(b=e==null?void 0:e.values)==null?void 0:b.region,name:"region",type:"text",onChange:e.handleChange,id:"Region",placeholder:"Ingresar Region"})]}),a.jsxs("div",{className:"flex-container",children:[a.jsxs("div",{className:"sm:w-[48%]",children:[a.jsx("label",{htmlFor:"farm",className:"label",children:"Finca"}),a.jsx(x,{value:(F=e==null?void 0:e.values)==null?void 0:F.farm,name:"farm",type:"text",required:!0,onChange:e.handleChange,id:"farm",placeholder:"Ingresar Finca"})]}),a.jsxs("div",{className:"sm:w-[48%]",children:[a.jsx("label",{htmlFor:"sca_score",className:"label",children:"Puntunaction Sca s"}),a.jsx(x,{value:(P=e==null?void 0:e.values)==null?void 0:P.sca_score,name:"sca_score",type:"number",required:!0,min:80,max:100,onChange:e.handleChange,id:"sca_score",placeholder:"Ingresar Puntunaction Sca s"})]})]}),a.jsxs("div",{className:"flex-container",children:[a.jsxs("div",{className:"sm:w-[48%]",children:[a.jsx("label",{htmlFor:"altitude",className:"label",children:"Altitud"}),a.jsx(x,{value:(i=e==null?void 0:e.values)==null?void 0:i.altitude,name:"altitude",type:"number",min:0,max:8e3,required:!0,onChange:e.handleChange,id:"altitude",placeholder:"Ingresar Altitud"})]}),a.jsxs("div",{className:"sm:w-[48%]",children:[a.jsx("label",{htmlFor:"process",className:"label",children:"Proceso"}),a.jsx(x,{value:(v=e==null?void 0:e.values)==null?void 0:v.process,name:"process",type:"text",required:!0,onChange:e.handleChange,id:"process",placeholder:"Ingresar process"})]})]}),a.jsxs("div",{className:"mb-8",children:[a.jsx("label",{htmlFor:"Variedad",className:"label",children:"Variedad"}),a.jsx(x,{value:(C=e==null?void 0:e.values)==null?void 0:C.grades,name:"grades",type:"text",onChange:e.handleChange,id:"Variedad",placeholder:"Ingresar Variedad"})]}),a.jsx(f,{formik:e,dataKey:"coffeeShops",url:"/setups/coffee-shop/add-coffee",title:"Tiendas",pageKey:"Coffee Shops",pagePermissionKeyName:"dashboard.coffeeShops.store",options:u,stateList:n,listOfState:h}),a.jsxs(c.Fragment,{children:[a.jsx("label",{htmlFor:"Description",className:"label",children:"Descripción"}),a.jsx("textarea",{rows:5,onChange:e.handleChange,type:"text",value:(j=e==null?void 0:e.values)==null?void 0:j.description,name:"description",id:"Description",className:"p-3 w-full border rounded-[5px] mt-5 resize-none border-[#b3b3b3] placeholder:text-[#b3b3b3]",placeholder:"Ingresar Descripción"})]}),a.jsx(K,{formik:e,roasters:o,provider_id:t==null?void 0:t.id}),a.jsx("button",{type:"submit",className:"min-btn mt-10 block ml-auto",children:"Enviar"})]})}export{U as P};
