import{n as y,u as A,l as C,r as p,A as _,G as F,o as R,h as j,S as E,R as W,j as s,F as z,z as V,P as D,D as S,I as G}from"./index-UqVmnRqZ.js";const L=()=>{var m,w,i;const e=y().search.slice(4),g=new F,r=new E,t=A(),o=C({initialValues:{presentations:[]}});p.useEffect(()=>(o.setValues({presentations:[]}),()=>{}),[]);const[n,x]=p.useState({}),{setIsLoading:l}=p.useContext(_);p.useEffect(()=>(l(!0),g.getSingleSubscription(e).then(a=>x(a)).finally(a=>l(!1)),()=>{}),[]);const v=(a,d)=>parseInt(d)!==parseInt(n==null?void 0:n.total)?j.warning("warning","the Packages Must be the same of the total subscription Packages"):(l(!0),r.acceptSubscription(e,a,t).finally(f=>l(!1))),h=(i=(w=(m=o.values)==null?void 0:m.presentations)==null?void 0:w.map(a=>(a==null?void 0:a.weight)*(a==null?void 0:a.units)))==null?void 0:i.reduce((a,d)=>a+d,0),N=R(()=>{var a;return v((a=o.values)==null?void 0:a.presentations,h)});return p.useEffect(()=>{n&&o.setFieldValue("presentations",n==null?void 0:n.presentations)},[n]),{formik:o,subscriptionItem:n,totalWeightOfPersentations:h,clickHandler:N}},O=(c,e,g)=>{const[r,t]=p.useState({}),[o,n]=p.useState({}),x=p.useRef(),[l,v]=p.useState(1),[h,N]=p.useState({weight:"",id:"",units:0,commercial_name:""});return{setAddNewPackage:N,inputWeightRef:x,handelAddNewPackage:()=>{var i,a;!(r!=null&&r.commercial_name)||!((i=x.current)!=null&&i.value)||!h.weight?j.warning("warning","Please Fill The Reqriure Inputs"):parseInt(h.units)*parseInt(h.weight)+g<=e?(c.setFieldValue("presentations",[...(a=c.values)==null?void 0:a.presentations,{...h,id:l}]),v(f=>f+1),x.current.value="",j.success("success","Package Add Successfully")):j.warning("warning","Packages more than the total size of the subscriptions")},removePackage:i=>{var a,d;return(d=(a=c.values)==null?void 0:a.presentations)==null?void 0:d.filter(f=>+f.id!=+i)},selectedProduct:r,setSelectProduct:t,selectedWeight:o,setSelectWeight:n}};function $({formik:c,removePackage:e}){var g,r;return s.jsx("div",{className:"col-span-6",children:s.jsx("div",{className:"border border-[#252525] p-[32px] rounded-[20px] h-full max-h-[270px] overflow-y-auto add-package",children:(r=(g=c.values)==null?void 0:g.presentations)==null?void 0:r.map((t,o)=>s.jsxs("div",{id:t.id,className:"flex items-center justify-between p-3 rounded-[5px] border border-[#252525] mb-5",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-[#252525] mb-3",children:t==null?void 0:t.commercial_name}),s.jsxs("p",{className:"font-medium text-[#252525]",children:[" ",t==null?void 0:t.units," x ",t==null?void 0:t.weight," gm"]})]}),s.jsx(z,{icon:V,onClick:n=>c.setFieldValue("presentations",e(t.id)),className:"text-[#252525] text-[20px] cursor-pointer"})]},o))})})}const q=W.memo($);function M(){var m,w,i,a,d,f;const{formik:c,subscriptionItem:e,totalWeightOfPersentations:g,clickHandler:r}=L(),{setAddNewPackage:t,inputWeightRef:o,handelAddNewPackage:n,removePackage:x,selectedProduct:l,setSelectProduct:v,selectedWeight:h,setSelectWeight:N}=O(c,e==null?void 0:e.total,g);return s.jsxs(D,{title:`Gestionar paquetes ( ${(m=e==null?void 0:e.user)==null?void 0:m.name} / ${(i=(w=e==null?void 0:e.plan_size)==null?void 0:w.size)==null?void 0:i.weight} = ${e==null?void 0:e.price} )`,showActions:!1,children:[s.jsxs("div",{className:"grid grid-cols-12 gap-10 p-4 px-10",children:[s.jsxs("form",{onSubmit:u=>u.preventDefault(),className:"col-span-6",children:[s.jsxs("div",{className:"mb-8",children:[s.jsx("label",{className:"label",children:"Nombre del Producto"}),s.jsx(S,{value:l,onChange:u=>{t(b=>{var P;return{...b,commercial_name:(P=u.value)==null?void 0:P.commercial_name}}),v(u.value)},filter:!0,options:(a=e==null?void 0:e.plan)==null?void 0:a.products,optionLabel:"commercial_name",placeholder:"Seleccionar Producto",className:"w-full p-2  !shadow-none !rounded-none !border-t-transparent !border-l-transparent !border-r-transparent"})]}),s.jsxs("div",{className:"mb-8",children:[s.jsx("label",{htmlFor:"weight",className:"label",children:"Peso / gm "}),s.jsx(S,{value:h,onChange:u=>{t(b=>{var P,k;return{...b,weight:(P=u.value)==null?void 0:P.weight,presentationId:(k=u.value)==null?void 0:k.id}}),N(u.value)},filter:!0,options:l==null?void 0:l.presentations,optionLabel:"weight",placeholder:"Seleccionar Peso",className:"w-full p-2  !shadow-none !rounded-none !border-t-transparent !border-l-transparent !border-r-transparent"})]}),s.jsxs("div",{className:"mb-8",children:[s.jsx("label",{htmlFor:"Quantity",className:"label",children:"Cantidad"}),s.jsx(G,{ref:o,onChange:u=>t(b=>({...b,units:u.target.value})),type:"number",id:"Quantity",placeholder:"Cantidad"})]}),s.jsx("button",{type:"button",onClick:n,className:"bg-[#58291E] text-[20px] text-center text-white font-medium w-full py-[16px] px-[24px] rounded-full",children:"Agregar paquete"})]}),s.jsx(q,{formik:c,selectedProduct:l,removePackage:x})]}),s.jsxs("div",{className:"flex flex-col items-end justify-center px-10 mt-3 mb-10",children:[s.jsxs("h3",{className:"text-[24px] text-[#58291E] mb-24",children:[g," / ",(f=(d=e==null?void 0:e.plan_size)==null?void 0:d.size)==null?void 0:f.weight," gm"]}),s.jsx("button",{onClick:r,type:"submit",className:"min-btn",children:"Enviar"})]})]})}export{M as default};
